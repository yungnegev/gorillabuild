# Active Workout

**Роут:** `workout/active`

При открытии с `?planId=...` — тренировка с prefill из плана (список упражнений и `plannedSetCount`). Без `planId` — пустая тренировка.

## Назначение

Экран активной тренировки — основной рабочий экран в зале. Позволяет логировать упражнения и подходы в реальном времени.

## Сценарий (S1)

Start → добавить упражнение → добавить подходы (вес/повторы) → Finish

## Как открывается

- FAB "Start empty workout" на экране Plans → пустая тренировка
- Кнопка "Start plan" на Plan Detail → тренировка с prefill из плана
- Автоматически при запуске приложения, если есть незавершённая тренировка

## Содержимое экрана

- Кнопка «Добавить упражнение» — открывает выбор из списка упражнений; при пустой тренировке показывается подсказка «Добавьте первое упражнение».
- Список упражнений тренировки (при prefill — из плана с учётом `plannedSetCount`)
- Под каждым упражнением — строки подходов: поля `weightKg` и `reps`
- Кнопка "+ подход" под каждым упражнением
- Кнопка "Finish workout" (устанавливает `finishedAt`, возврат на Plans)

## Prefill при старте плана

- Упражнения и число подходов берутся из `PlanExercise.plannedSetCount`
- `weightKg` и `reps` каждого подхода предзаполняются значениями из последней тренировки по этому упражнению
- Пользователь правит значения на месте

## Переходы

- Тап на упражнение → `exercise/[id]` (Exercise Detail)
- "Finish workout" → устанавливает `finishedAt`, закрывает экран, возврат на Plans

## Граничные кейсы

- При сворачивании или закрытии приложения тренировка сохраняется как незавершённая (`finishedAt` = null)
- При следующем открытии приложения незавершённая тренировка восстанавливается автоматически (*в веб: при переходе на `workout/active` подгружается существующая активная тренировка через GET /api/workouts; автооткрытие при старте приложения не реализовано*)

## Модель данных

| Сущность | Поля |
|----------|------|
| `Workout` | `id`, `userId`, `startedAt`, `finishedAt?` |
| `WorkoutExercise` | `workoutId`, `exerciseId`, `order` |
| `SetEntry` | `workoutExerciseId`, `order`, `weightKg`, `reps` |

## API (веб)

- `GET /api/workouts` — активная тренировка (finishedAt = null) с упражнениями и подходами; при отсутствии создаётся через POST.
- `POST /api/workouts` — старт тренировки (тело: `{ planId? }`); при `planId` создаёт упражнения и подходы с prefill веса/повторов из последней тренировки.
- `PATCH /api/workouts/[id]` — завершение (установка `finishedAt`).
- `POST /api/workouts/[id]/exercises` — добавление упражнения в активную тренировку (тело: `{ exerciseId }`). Используется для пустой тренировки и для добавления упражнений по ходу.
- `GET /api/exercises` — список всех упражнений (для выбора при «Добавить упражнение»).
- `PATCH /api/sets/[id]` — обновление подхода (`weightKg`, `reps`).
- `POST /api/workout-exercises/[id]/sets` — добавление подхода.
