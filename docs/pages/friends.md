# Friends

**Роут:** `/friends`

## Назначение

Список друзей пользователя, добавление новых и сравнение результатов по упражнениям.

## Содержимое экрана `/friends`

- Кнопка «Добавить друга» — поиск по handle, отправка заявки
- Блок «Входящие заявки» — заявки в друзья (pending), где текущий пользователь — получатель; у каждой кнопка «Принять»
- Список принятых друзей (`Friendship.status = accepted`)

## Содержимое экрана `/friends/[id]` (Friend Detail)

`[id]` — `friendshipId` (id записи в `friendships`).

- Аватар, имя и username друга
- Список упражнений, по которым хотя бы один из двух имеет историю
- У каждого упражнения — лучший 1RM каждого (сводка)
- По клику на упражнение — раскрывается двулинейный график сравнения 1RM (я = белая линия, друг = лаймовая линия)

## Переходы

| Действие | Куда |
|----------|------|
| Тап на друга | `/friends/[id]` (Friend Detail) |
| Назад | `/friends` |

## Приватность

Друзья видят метрики по упражнениям (1RM). Масса тела как число **не отображается** друзьям.

## Модель данных

| Сущность | Поля |
|----------|------|
| `User` | `id`, `name`, `username` (ник/handle; задаётся в профиле) |
| `Friendship` | `fromUserId`, `toUserId`, `status` (pending / accepted) |

**Примечание:** Handle = `users.username`. При входе через Gmail ник не задаётся автоматически — пользователь указывает его в профиле.

## Добавление в друзья (отправка заявки)

1. Пользователь нажимает «Добавить друга», вводит handle (ник) другого пользователя.
2. **POST /api/friends** — тело `{ "handle": "ник" }`. Бэкенд ищет пользователя по `username`, создаёт запись в `friendships` с `status: "pending"` (`fromUserId` — отправитель, `toUserId` — получатель).
3. Повторная заявка тому же пользователю возвращает 409 (Request already exists). Нельзя отправить заявку себе (400).

## Принятие заявок

1. Входящие заявки: **GET /api/friends/requests** — возвращает записи, где `toUserId` = текущий пользователь и `status = "pending"`.
2. Принять заявку: **PATCH /api/friends/[id]/accept**, где `[id]` — `friendshipId`. Обновляет `status` на `"accepted"`. Вызывать может только получатель заявки (`toUserId`).

## API друзей (список)

| Метод | Роут | Описание |
|-------|------|----------|
| GET | `/api/friends` | Принятые друзья текущего пользователя. Ответ: массив `FriendItem` (friendshipId, userId, username, name, imageUrl). |

## Friend Detail API

| Метод | Роут | Описание |
|-------|------|----------|
| GET | `/api/friends/[id]` | Профиль друга (имя, username, аватар) |
| GET | `/api/friends/[id]/exercises` | Упражнения с историей + лучший 1RM каждого |
| GET | `/api/friends/[id]/exercises/[exerciseId]` | Полная история 1RM по упражнению для обоих (данные для графика) |
